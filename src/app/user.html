<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="View and manage user" />
		<title>Warden user</title>
		<style></style>
	</head>
	<body class="font-sans m-0 text-black dark:text-white background-white dark:background-black" onload="loadUser()">
		<header class="sticky top-0 w-full background-neutral-100 dark:background-neutral-900 z-4">
			<nav
				class="flex flex-row gap-2 sm:gap-3 lg:gap-4 pt-2 sm:pt-3 lg:pt-4 pr-4 sm:pr-6 lg:pr-8 pb-2 sm:pb-3 lg:pb-4 pl-4 sm:pl-6 lg:pl-8 text-lg font-normal overflow-x-auto scrollbar-none"
			>
				<a href="/" class="no-underline text-black dark:text-white">Home</a>
				<a href="/devices" class="no-underline text-black dark:text-white">Devices</a>
				<a href="/uplinks" class="no-underline text-black dark:text-white">Uplinks</a>
				<a href="/downlinks" class="no-underline text-black dark:text-white">Downlinks</a>
				<a href="/users" class="no-underline text-black dark:text-white">Users</a>
			</nav>
		</header>
		<main class="m-4 sm:m-6 lg:m-8">
			<div
				id="tabs"
				class="flex gap-2 sm:gap-3 lg:gap-4 m-0 pt-2 sm:pt-3 lg:pt-4 pb-2 sm:pb-3 lg:pb-4 text-base font-normal border-0 border-b-1 border-solid border-b-neutral-400 dark:border-b-neutral-600 overflow-x-auto scrollbar-none"
			>
				<a class="no-underline text-blue-600 dark:text-blue-400">Details</a>
				<a class="no-underline text-black dark:text-white">Devices</a>
			</div>
			<div class="overflow-x-auto scrollbar-none">
				<table style="border-collapse: collapse" class="w-full text-nowrap">
					<tbody id="user">
						<tr class="border-solid border-t-0 border-r-0 border-b-1 border-l-0 border-b-neutral-300 dark:border-b-neutral-700">
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4 text-neutral-600 dark:text-neutral-400">
								<p class="m-0">Id</p>
							</td>
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4">
								<p class="font-mono m-0 w-80 h-4.5 background-neutral-200 dark:background-neutral-800"></p>
							</td>
						</tr>
						<tr class="border-solid border-t-0 border-r-0 border-b-1 border-l-0 border-b-neutral-300 dark:border-b-neutral-700">
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4 text-neutral-600 dark:text-neutral-400">
								<p class="m-0">Username</p>
							</td>
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4">
								<p class="m-0 w-32 h-4.5 background-neutral-200 dark:background-neutral-800"></p>
							</td>
						</tr>
						<tr class="border-solid border-t-0 border-r-0 border-b-1 border-l-0 border-b-neutral-300 dark:border-b-neutral-700">
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4 text-neutral-600 dark:text-neutral-400">
								<p class="m-0">Signup at</p>
							</td>
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4">
								<p class="m-0 w-40 h-4.5 background-neutral-200 dark:background-neutral-800"></p>
							</td>
						</tr>
						<tr class="border-solid border-t-0 border-r-0 border-b-1 border-l-0 border-b-neutral-300 dark:border-b-neutral-700">
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4 text-neutral-600 dark:text-neutral-400">
								<p class="m-0">Signin at</p>
							</td>
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4">
								<p class="m-0 w-40 h-4.5 background-neutral-200 dark:background-neutral-800"></p>
							</td>
						</tr>
						<tr class="border-solid border-t-0 border-r-0 border-b-1 border-l-0 border-b-neutral-300 dark:border-b-neutral-700">
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4 text-neutral-600 dark:text-neutral-400">
								<p class="m-0">Permissions</p>
							</td>
							<td class="pt-2 sm:pt-3 lg:pt-4 pr-2 sm:pr-3 lg:pr-4 pb-2 sm:pb-3 lg:pb-4">
								<p class="font-mono m-0 w-20 h-4.5 background-neutral-200 dark:background-neutral-800"></p>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</main>
	</body>
	<script>
		import './src/app/state.js';
		import './src/app/timestamp.js';
		import './src/app/binary.js';
		import './src/app/fetcher.js';
		import './src/app/fetching.js';
		const tabs = document.getElementById('tabs');
		tabs.children[0].href = `${window.location.pathname.substring(0, 38)}`;
		tabs.children[1].href = `${window.location.pathname.substring(0, 38)}/devices`;
		const user = { retries: 0, reload: 10, timeout: null, controller: null, data: null, element: document.getElementById('user') };
		const loadingUser = (element) => {
			loading(element.children[0].children[1].children[0], ['w-80', 'h-4.5'], [], '');
			loading(element.children[1].children[1].children[0], ['w-32', 'h-4.5'], [], '');
			loading(element.children[2].children[1].children[0], ['w-40', 'h-4.5'], [], '');
			loading(element.children[3].children[1].children[0], ['w-40', 'h-4.5'], [], '');
			loading(element.children[4].children[1].children[0], ['w-20', 'h-4.5'], [], '');
		};
		const paintUser = (element, data) => {
			paint(element.children[0].children[1].children[0], [], ['w-80', 'h-4.5'], data.id);
			paint(element.children[1].children[1].children[0], [], ['w-32', 'h-4.5'], data.username);
			paint(element.children[2].children[1].children[0], [], ['w-40', 'h-4.5'], timestamp(data.signupAt));
			paint(element.children[3].children[1].children[0], [], ['w-40', 'h-4.5'], timestamp(data.signinAt));
			paint(element.children[4].children[1].children[0], [], ['w-20', 'h-4.5'], data.permissions);
		};
		const errorUser = (element) => {
			error(element.children[0].children[1].children[0], ['w-80', 'h-4.5'], [], '');
			error(element.children[1].children[1].children[0], ['w-32', 'h-4.5'], [], '');
			error(element.children[2].children[1].children[0], ['w-40', 'h-4.5'], [], '');
			error(element.children[3].children[1].children[0], ['w-40', 'h-4.5'], [], '');
			error(element.children[4].children[1].children[0], ['w-20', 'h-4.5'], [], '');
		};
		const parseUser = async (response) => {
			const buffer = await response.arrayBuffer();
			const binary = new Binary(buffer);
			const user = { id: null, username: null, signupAt: null, signinAt: null, permissions: null };
			user.id = binary.uuid();
			user.username = binary.string();
			user.signupAt = binary.uint(64);
			user.signinAt = binary.uint(64);
			user.permissions = binary.hex(binary.uint(8));
			return user;
		};
		const loadUser = fetching(
			user,
			(context) => window.requestAnimationFrame(() => loadingUser(context.element)),
			(context) => fetcher('get', `/api/user/${window.location.pathname.substring(6)}`, null, { controller: context.controller }),
			async (context, response) => (context.data = await parseUser(response)),
			(context) => window.requestAnimationFrame(() => paintUser(context.element, context.data)),
			(context) => window.requestAnimationFrame(() => errorUser(context.element))
		);
	</script>
</html>
