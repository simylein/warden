<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="View buffers from your device" />
		<title>Warden device buffers</title>
		<style></style>
	</head>
	<body
		class="font-sans min-h-dvh flex flex-col m-0 text-base leading-none text-black dark:text-white background-white dark:background-black"
		onload="loadBuffers()"
	>
		<header class="sticky top-0 w-full background-neutral-100 dark:background-neutral-900 z-4">
			<nav
				class="flex flex-row gap-2 sm:gap-3 lg:gap-4 pt-2 sm:pt-3 lg:pt-4 pr-4 sm:pr-6 lg:pr-8 pb-2 sm:pb-3 lg:pb-4 pl-4 sm:pl-6 lg:pl-8 text-lg font-normal overflow-x-auto scrollbar-none"
			>
				<a href="/" class="no-underline text-black dark:text-white">Home</a>
				<a href="/devices" class="no-underline text-black dark:text-white">Devices</a>
				<a href="/uplinks" class="no-underline text-black dark:text-white">Uplinks</a>
				<a href="/downlinks" class="no-underline text-black dark:text-white">Downlinks</a>
				<a href="/users" class="no-underline text-black dark:text-white">Users</a>
			</nav>
		</header>
		<main class="flex flex-col grow m-4 sm:m-6 lg:m-8">
			<div
				id="tabs"
				class="flex gap-2 sm:gap-3 lg:gap-4 m-0 mb-2 sm:mb-3 lg:mb-4 pt-2 sm:pt-3 lg:pt-4 pb-2 sm:pb-3 lg:pb-4 text-base font-normal border-0 border-b-1 border-solid border-b-neutral-400 dark:border-b-neutral-600 overflow-x-auto scrollbar-none"
			>
				<a class="no-underline text-black dark:text-white">Details</a>
				<a class="no-underline text-black dark:text-white">Readings</a>
				<a class="no-underline text-black dark:text-white">Metrics</a>
				<a class="no-underline text-blue-600 dark:text-blue-400">Buffers</a>
				<a class="no-underline text-black dark:text-white">Signals</a>
				<a class="no-underline text-black dark:text-white">Uplinks</a>
				<a class="no-underline text-black dark:text-white">Downlinks</a>
			</div>
			<div class="flex flex-col gap-2 sm:gap-3 lg:gap-4">
				<div id="ranges" class="flex gap-2 sm:gap-3 md:gap-4 overflow-x-auto scrollbar-none text-nowrap">
					<button
						value="1209600"
						class="p-1 md:p-1.5 lg:p-2 border-none background-neutral-100 dark:background-neutral-900 cursor-pointer"
						onclick="highlightRange(1209600); setRange(1209600); deviceTabs(); loadBuffers()"
					>
						<p class="sm:hidden m-0 text-base font-normal text-black dark:text-white">14d</p>
						<p class="hidden sm:block m-0 text-base font-normal text-black dark:text-white">14 days</p>
					</button>
					<button
						value="604800"
						class="p-1 md:p-1.5 lg:p-2 border-none background-neutral-100 dark:background-neutral-900 cursor-pointer"
						onclick="highlightRange(604800); setRange(604800); deviceTabs(); loadBuffers()"
					>
						<p class="sm:hidden m-0 text-base font-normal text-black dark:text-white">7d</p>
						<p class="hidden sm:block m-0 text-base font-normal text-black dark:text-white">7 days</p>
					</button>
					<button
						value="345600"
						class="p-1 md:p-1.5 lg:p-2 border-none background-neutral-100 dark:background-neutral-900 cursor-pointer"
						onclick="highlightRange(345600); setRange(345600); deviceTabs(); loadBuffers()"
					>
						<p class="sm:hidden m-0 text-base font-normal text-black dark:text-white">4d</p>
						<p class="hidden sm:block m-0 text-base font-normal text-black dark:text-white">4 days</p>
					</button>
					<button
						value="172800"
						class="p-1 md:p-1.5 lg:p-2 border-none background-neutral-100 dark:background-neutral-900 cursor-pointer"
						onclick="highlightRange(172800); setRange(172800); deviceTabs(); loadBuffers()"
					>
						<p class="sm:hidden m-0 text-base font-normal text-black dark:text-white">2d</p>
						<p class="hidden sm:block m-0 text-base font-normal text-black dark:text-white">2 days</p>
					</button>
					<button
						value="86400"
						class="p-1 md:p-1.5 lg:p-2 border-none background-neutral-100 dark:background-neutral-900 cursor-pointer"
						onclick="highlightRange(86400); setRange(86400); deviceTabs(); loadBuffers()"
					>
						<p class="sm:hidden m-0 text-base font-normal text-black dark:text-white">24h</p>
						<p class="hidden sm:block m-0 text-base font-normal text-black dark:text-white">24 hours</p>
					</button>
					<button
						value="43200"
						class="p-1 md:p-1.5 lg:p-2 border-none background-neutral-100 dark:background-neutral-900 cursor-pointer"
						onclick="highlightRange(43200); setRange(43200); deviceTabs(); loadBuffers()"
					>
						<p class="sm:hidden m-0 text-base font-normal text-black dark:text-white">12h</p>
						<p class="hidden sm:block m-0 text-base font-normal text-black dark:text-white">12 hours</p>
					</button>
					<button
						value="21600"
						class="p-1 md:p-1.5 lg:p-2 border-none background-neutral-100 dark:background-neutral-900 cursor-pointer"
						onclick="highlightRange(21600); setRange(21600); deviceTabs(); loadBuffers()"
					>
						<p class="sm:hidden m-0 text-base font-normal text-black dark:text-white">6h</p>
						<p class="hidden sm:block m-0 text-base font-normal text-black dark:text-white">6 hours</p>
					</button>
					<button
						value="10800"
						class="p-1 md:p-1.5 lg:p-2 border-none background-neutral-100 dark:background-neutral-900 cursor-pointer"
						onclick="highlightRange(10800); setRange(10800); deviceTabs(); loadBuffers()"
					>
						<p class="sm:hidden m-0 text-base font-normal text-black dark:text-white">3h</p>
						<p class="hidden sm:block m-0 text-base font-normal text-black dark:text-white">3 hours</p>
					</button>
					<button
						value="3600"
						class="p-1 md:p-1.5 lg:p-2 border-none background-neutral-100 dark:background-neutral-900 cursor-pointer"
						onclick="highlightRange(3600); setRange(3600); deviceTabs(); loadBuffers()"
					>
						<p class="sm:hidden m-0 text-base font-normal text-black dark:text-white">60m</p>
						<p class="hidden sm:block m-0 text-base font-normal text-black dark:text-white">60 minutes</p>
					</button>
				</div>
				<div class="p-2 sm:p-3 lg:p-4 background-neutral-100 dark:background-neutral-900">
					<div class="flex justify-between gap-2 mb-1 sm:mb-2">
						<h2 class="m-0 text-base font-normal">Delay</h2>
						<p id="delay-range" class="m-0 w-28 h-4 background-neutral-200 dark:background-neutral-800"><span></span><span></span><span></span></p>
					</div>
					<div style="grid-template-columns: auto 1fr; grid-template-rows: auto auto" class="grid gap-1 sm:gap-2">
						<div id="delay-scale" class="flex flex-col text-xs text-end">
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
						</div>
						<div class="relative flex flex-col">
							<svg id="delay-graph" class="absolute w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
								<path
									class="stroke-neutral-200 dark:stroke-neutral-800"
									fill="none"
									stroke-width="2"
									d="M 0 53 L 1 36 L 2 33 L 3 32 L 4 38 L 5 35 L 6 29 L 7 39 L 8 43 L 9 57 L 10 72 L 11 73 L 12 74 L 13 57 L 14 47 L 15 35 L 16 36 L 17 51 L 18 52 L 19 47 L 20 37 L 21 33 L 22 40 L 23 25 L 24 43 L 25 47 L 26 31 L 27 39 L 28 39 L 29 47 L 30 33 L 31 35 L 32 30 L 33 31 L 34 31 L 35 38 L 36 36 L 37 43 L 38 59 L 39 69 L 40 65 L 41 75 L 42 57 L 43 56 L 44 57 L 45 70 L 46 80 L 47 73 L 48 91 L 49 79 L 50 92 L 51 82 L 52 82 L 53 62 L 54 67 L 55 79 L 56 86 L 57 90 L 58 80 L 59 92 L 60 87 L 61 90 L 62 94 L 63 93 L 64 85 L 65 67 L 66 58 L 67 43 L 68 54 L 69 50 L 70 40 L 71 41 L 72 42 L 73 57 L 74 62 L 75 46 L 76 55 L 77 59 L 78 75 L 79 76 L 80 57 L 81 49 L 82 66 L 83 51 L 84 71 L 85 74 L 86 54 L 87 56 L 88 50 L 89 55 L 90 69 L 91 81 L 92 64 L 93 84 L 94 82 L 95 93 L 96 77 L 97 71 L 98 85 L 99 95 L 100 86"
								/>
								<path class="stroke-green-400/80 dark:stroke-green-600/80" fill="none" stroke-width="2" />
								<path class="stroke-lime-400/80 dark:stroke-lime-600/80" fill="none" stroke-width="2" />
								<path class="stroke-yellow-400/80 dark:stroke-yellow-600/80" fill="none" stroke-width="2" />
								<path class="stroke-amber-400/80 dark:stroke-amber-600/80" fill="none" stroke-width="2" />
								<path class="stroke-orange-400/80 dark:stroke-orange-600/80" fill="none" stroke-width="2" />
								<path class="stroke-red-400/80 dark:stroke-red-600/80" fill="none" stroke-width="2" />
							</svg>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
						</div>
						<div></div>
						<div id="delay-label" class="w-full flex justify-around text-xs">
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden sm:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden sm:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden sm:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
						</div>
					</div>
				</div>
				<div class="p-2 sm:p-3 lg:p-4 background-neutral-100 dark:background-neutral-900">
					<div class="flex justify-between gap-2 mb-1 sm:mb-2">
						<h2 class="m-0 text-base font-normal">Level</h2>
						<p id="level-range" class="m-0 w-28 h-4 background-neutral-200 dark:background-neutral-800"><span></span><span></span><span></span></p>
					</div>
					<div style="grid-template-columns: auto 1fr; grid-template-rows: auto auto" class="grid gap-1 sm:gap-2">
						<div id="level-scale" class="flex flex-col text-xs text-end">
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="min-w-7 h-3 mt-5 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
						</div>
						<div class="relative flex flex-col">
							<svg id="level-graph" class="absolute w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
								<path
									class="stroke-neutral-200 dark:stroke-neutral-800"
									fill="none"
									stroke-width="2"
									d="M 0 64 L 1 72 L 2 81 L 3 88 L 4 92 L 5 74 L 6 93 L 7 84 L 8 71 L 9 71 L 10 82 L 11 69 L 12 54 L 13 64 L 14 73 L 15 55 L 16 51 L 17 40 L 18 28 L 19 30 L 20 29 L 21 33 L 22 46 L 23 65 L 24 79 L 25 94 L 26 81 L 27 91 L 28 92 L 29 76 L 30 92 L 31 84 L 32 66 L 33 69 L 34 68 L 35 74 L 36 66 L 37 68 L 38 56 L 39 50 L 40 58 L 41 46 L 42 66 L 43 69 L 44 69 L 45 50 L 46 50 L 47 49 L 48 39 L 49 56 L 50 61 L 51 46 L 52 51 L 53 62 L 54 77 L 55 94 L 56 87 L 57 83 L 58 65 L 59 74 L 60 69 L 61 77 L 62 91 L 63 78 L 64 66 L 65 61 L 66 71 L 67 64 L 68 61 L 69 80 L 70 93 L 71 81 L 72 95 L 73 95 L 74 84 L 75 91 L 76 82 L 77 73 L 78 70 L 79 87 L 80 86 L 81 95 L 82 82 L 83 73 L 84 53 L 85 35 L 86 34 L 87 36 L 88 33 L 89 31 L 90 29 L 91 26 L 92 27 L 93 29 L 94 34 L 95 32 L 96 43 L 97 47 L 98 41 L 99 38 L 100 32"
								/>
								<path class="stroke-green-400/80 dark:stroke-green-600/80" fill="none" stroke-width="2" />
								<path class="stroke-lime-400/80 dark:stroke-lime-600/80" fill="none" stroke-width="2" />
								<path class="stroke-yellow-400/80 dark:stroke-yellow-600/80" fill="none" stroke-width="2" />
								<path class="stroke-amber-400/80 dark:stroke-amber-600/80" fill="none" stroke-width="2" />
								<path class="stroke-orange-400/80 dark:stroke-orange-600/80" fill="none" stroke-width="2" />
								<path class="stroke-red-400/80 dark:stroke-red-600/80" fill="none" stroke-width="2" />
							</svg>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
							<span class="box-border h-8 border-0 border-b-1 border-solid border-neutral-300 dark:border-neutral-600"></span>
						</div>
						<div></div>
						<div id="level-label" class="w-full flex justify-around text-xs">
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden sm:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden sm:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden sm:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
							<label class="hidden lg:inline w-8 h-3 text-neutral-600 dark:text-neutral-400 background-neutral-200 dark:background-neutral-800"></label>
						</div>
					</div>
				</div>
			</div>
		</main>
		<footer class="w-full background-neutral-100 dark:background-neutral-900">
			<div
				class="flex flex-row justify-between gap-2 sm:gap-3 lg:gap-4 pt-2 sm:pt-3 lg:pt-4 pr-4 sm:pr-6 lg:pr-8 pb-2 sm:pb-3 lg:pb-4 pl-4 sm:pl-6 lg:pl-8 text-lg font-normal text-nowrap overflow-x-auto scrollbar-none"
			>
				<p class="m-0 text-xs font-normal text-neutral-400 dark:text-neutral-600">warden {version} {commit}</p>
				<p class="m-0 text-xs font-normal text-neutral-400 dark:text-neutral-600">written by simylein</p>
			</div>
		</footer>
	</body>
	<script>
		import './src/app/scripts/duration.js';
		import './src/app/scripts/breakpoint.js';
		import './src/app/scripts/device-tabs.js';
		import './src/app/scripts/timespan.js';
		import './src/app/scripts/array.js';
		import './src/app/scripts/state.js';
		import './src/app/scripts/math.js';
		import './src/app/scripts/graph.js';
		import './src/app/scripts/fade.js';
		import './src/app/scripts/color-buffer.js';
		import './src/app/scripts/index-buffer.js';
		import './src/app/scripts/search.js';
		import './src/app/scripts/binary.js';
		import './src/app/scripts/fetcher.js';
		import './src/app/scripts/fetching.js';
		const ranges = document.getElementById('ranges');
		const buffers = { retries: 0, reload: null, timeout: null, controller: null, data: null, width: null };
		const delay = {
			range: document.getElementById('delay-range'),
			scale: document.getElementById('delay-scale'),
			graph: document.getElementById('delay-graph'),
			label: document.getElementById('delay-label'),
		};
		const level = {
			range: document.getElementById('level-range'),
			scale: document.getElementById('level-scale'),
			graph: document.getElementById('level-graph'),
			label: document.getElementById('level-label'),
		};
		const delaySkeleton = [
			53, 36, 33, 32, 38, 35, 29, 39, 43, 57, 72, 73, 74, 57, 47, 35, 36, 51, 52, 47, 37, 33, 40, 25, 43, 47, 31, 39, 39, 47, 33, 35, 30, 31, 31, 38, 36, 43,
			59, 69, 65, 75, 57, 56, 57, 70, 80, 73, 91, 79, 92, 82, 82, 62, 67, 79, 86, 90, 80, 92, 87, 90, 94, 93, 85, 67, 58, 43, 54, 50, 40, 41, 42, 57, 62, 46,
			55, 59, 75, 76, 57, 49, 66, 51, 71, 74, 54, 56, 50, 55, 69, 81, 64, 84, 82, 93, 77, 71, 85, 95, 86,
		];
		const levelSkeleton = [
			64, 72, 81, 88, 92, 74, 93, 84, 71, 71, 82, 69, 54, 64, 73, 55, 51, 40, 28, 30, 29, 33, 46, 65, 79, 94, 81, 91, 92, 76, 92, 84, 66, 69, 68, 74, 66, 68,
			56, 50, 58, 46, 66, 69, 69, 50, 50, 49, 39, 56, 61, 46, 51, 62, 77, 94, 87, 83, 65, 74, 69, 77, 91, 78, 66, 61, 71, 64, 61, 80, 93, 81, 95, 95, 84, 91,
			82, 73, 70, 87, 86, 95, 82, 73, 53, 35, 34, 36, 33, 31, 29, 26, 27, 29, 34, 32, 43, 47, 41, 38, 32,
		];
		window.addEventListener('resize', () => {
			const width = breakpoint(delay.graph.clientWidth);
			if (width !== buffers.width) {
				buffers.width = width;
				const summary = calculateBuffers(buffers.data, buffers.width);
				window.requestAnimationFrame(() => paintDelay(delay, buffers.width, summary.delay, summary.capturedAt));
				window.requestAnimationFrame(() => paintLevel(level, buffers.width, summary.level, summary.capturedAt));
			}
		});
		const getRange = () => {
			return +getParam('range', 86400);
		};
		const setRange = (range) => {
			setParam('range', range);
		};
		deviceTabs();
		const highlightRange = (range) => {
			array(ranges.children.length).forEach((ind) => {
				if (+ranges.children[ind].getAttribute('value') === range) {
					array(ranges.children[ind].children.length).forEach((i) => {
						ranges.children[ind].children[i].classList.add('text-blue-600', 'dark:text-blue-400');
						ranges.children[ind].children[i].classList.remove('text-black', 'dark:text-white');
					});
				} else {
					array(ranges.children[ind].children.length).forEach((i) => {
						ranges.children[ind].children[i].classList.remove('text-blue-600', 'dark:text-blue-400');
						ranges.children[ind].children[i].classList.add('text-black', 'dark:text-white');
					});
				}
			});
		};
		highlightRange(getRange());
		const loadingDelay = (element, width) => {
			array(element.label.children.length).forEach((ind) => {
				loading(element.label.children[ind], ['w-8', 'h-3'], [], '');
			});
			loading(element.range, ['w-28', 'h-4'], []);
			array(element.range.children.length).forEach((ind) => {
				loading(element.range.children[ind], [], [], '');
			});
			array(element.scale.children.length).forEach((ind) => {
				loading(element.scale.children[ind], ['h-3'], [], '');
			});
			element.graph.setAttribute('viewBox', `0 0 ${width} 100`);
			array(element.graph.children.length).forEach((ind) => {
				if (ind === 0) {
					element.graph.children[ind].classList.add('stroke-neutral-200', 'dark:stroke-neutral-800');
					element.graph.children[ind].classList.remove('stroke-red-200', 'dark:stroke-red-800');
					const factor = width / (delaySkeleton.length - 1);
					const skeleton = delaySkeleton.map((value, ind) => `${ind === 0 ? 'M' : 'L'} ${(ind * factor).toFixed(2)} ${value}`);
					element.graph.children[ind].setAttribute('d', skeleton.join(' '));
				} else {
					element.graph.children[ind].removeAttribute('d');
				}
			});
		};
		const paintDelay = (element, width, delay, capturedAt) => {
			const interval = (Number(capturedAt.end) - Number(capturedAt.start)) / (element.label.children.length - 1);
			if (capturedAt.start !== null && capturedAt.end !== null) {
				array(element.label.children.length).forEach((ind) => {
					const label = timespan(Number(capturedAt.start) + ind * interval, getRange());
					paint(element.label.children[element.label.children.length - ind - 1], [], ['w-8', 'h-3'], label);
				});
			}
			if (delay.min.abs !== null && delay.max.abs !== null) {
				paint(element.range, [], ['w-28', 'h-4']);
				paint(element.range.children[0], [], [], duration(delay.min.abs));
				fade(element.range.children[0]);
				colorDelay(element.range.children[0], delay.min.abs);
				paint(element.range.children[1], [], [], ' - ');
				paint(element.range.children[2], [], [], duration(delay.max.abs));
				fade(element.range.children[2]);
				colorDelay(element.range.children[2], delay.max.abs);
			}
			if (delay.min.floor !== null && delay.max.ceil !== null) {
				const scaleLength = element.scale.children.length;
				const interval = (delay.max.ceil - delay.min.floor) / scaleLength;
				array(scaleLength).forEach((ind) => {
					paint(element.scale.children[scaleLength - 1 - ind], [], ['h-3'], duration(delay.min.floor + ind * interval));
				});
			}
			let memo = null;
			const distance = width / delay.points.length;
			delay.points.forEach((point, ind) => {
				const index = indexDelay(point.v);
				const last = ind === 0 ? point : delay.points[ind - 1];
				let type = delay.paths[index].length === 0 ? 'M' : 'L';
				if (last.x - point.x > distance * 8) {
					type = 'M';
				} else if (memo !== null && memo !== index) {
					const mid = { x: (last.x + point.x) / 2, y: (last.y + point.y) / 2 };
					delay.paths[memo].push(`L ${mid.x.toFixed(2)} ${mid.y.toFixed(2)}`);
					delay.paths[index].push(`M ${mid.x.toFixed(2)} ${mid.y.toFixed(2)}`);
					type = 'L';
				}
				memo = index;
				delay.paths[index].push(`${type} ${point.x.toFixed(2)} ${point.y.toFixed(2)}`);
			});
			element.graph.setAttribute('viewBox', `0 0 ${width} 100`);
			const factor = width / (delaySkeleton.length - 1);
			const skeleton = delaySkeleton.map((value, ind) => `${ind === 0 ? 'M' : 'L'} ${(ind * factor).toFixed(2)} ${value}`);
			element.graph.children[0].setAttribute('d', skeleton.join(' '));
			if (capturedAt.start !== null && capturedAt.end !== null) {
				delay.paths.forEach((path, ind) => {
					if (path.length !== 0) {
						element.graph.children[ind].setAttribute('d', path.join(' '));
					} else {
						element.graph.children[ind].removeAttribute('d');
					}
				});
			}
		};
		const errorDelay = (element, width) => {
			array(element.label.children.length).forEach((ind) => {
				error(element.label.children[ind], ['w-8', 'h-3'], [], '');
			});
			error(element.range, ['w-28', 'h-4'], []);
			array(element.range.children.length).forEach((ind) => {
				error(element.range.children[ind], [], [], '');
			});
			array(element.scale.children.length).forEach((ind) => {
				error(element.scale.children[ind], ['h-3'], [], '');
			});
			element.graph.setAttribute('viewBox', `0 0 ${width} 100`);
			array(element.graph.children.length).forEach((ind) => {
				if (ind === 0) {
					element.graph.children[ind].classList.add('stroke-red-200', 'dark:stroke-red-800');
					element.graph.children[ind].classList.remove('stroke-neutral-200', 'dark:stroke-neutral-800');
					const factor = width / (delaySkeleton.length - 1);
					const skeleton = delaySkeleton.map((value, ind) => `${ind === 0 ? 'M' : 'L'} ${(ind * factor).toFixed(2)} ${value}`);
					element.graph.children[ind].setAttribute('d', skeleton.join(' '));
				} else {
					element.graph.children[ind].removeAttribute('d');
				}
			});
		};
		const loadingLevel = (element, width) => {
			array(element.label.children.length).forEach((ind) => {
				loading(element.label.children[ind], ['w-8', 'h-3'], [], '');
			});
			loading(element.range, ['w-28', 'h-4'], []);
			array(element.range.children.length).forEach((ind) => {
				loading(element.range.children[ind], [], [], '');
			});
			array(element.scale.children.length).forEach((ind) => {
				loading(element.scale.children[ind], ['h-3'], [], '');
			});
			element.graph.setAttribute('viewBox', `0 0 ${width} 100`);
			array(element.graph.children.length).forEach((ind) => {
				if (ind === 0) {
					element.graph.children[ind].classList.add('stroke-neutral-200', 'dark:stroke-neutral-800');
					element.graph.children[ind].classList.remove('stroke-red-200', 'dark:stroke-red-800');
					const factor = width / (levelSkeleton.length - 1);
					const skeleton = levelSkeleton.map((value, ind) => `${ind === 0 ? 'M' : 'L'} ${(ind * factor).toFixed(2)} ${value}`);
					element.graph.children[ind].setAttribute('d', skeleton.join(' '));
				} else {
					element.graph.children[ind].removeAttribute('d');
				}
			});
		};
		const paintLevel = (element, width, level, capturedAt) => {
			const interval = (Number(capturedAt.end) - Number(capturedAt.start)) / (element.label.children.length - 1);
			if (capturedAt.start !== null && capturedAt.end !== null) {
				array(element.label.children.length).forEach((ind) => {
					const label = timespan(Number(capturedAt.start) + ind * interval, getRange());
					paint(element.label.children[element.label.children.length - ind - 1], [], ['w-8', 'h-3'], label);
				});
			}
			if (level.min.abs !== null && level.max.abs !== null) {
				paint(element.range, [], ['w-28', 'h-4']);
				paint(element.range.children[0], [], [], level.min.abs.toFixed(0));
				fade(element.range.children[0]);
				colorLevel(element.range.children[0], level.min.abs);
				paint(element.range.children[1], [], [], ' - ');
				paint(element.range.children[2], [], [], level.max.abs.toFixed(0));
				fade(element.range.children[2]);
				colorLevel(element.range.children[2], level.max.abs);
			}
			if (level.min.floor !== null && level.max.ceil !== null) {
				const scaleLength = element.scale.children.length;
				const interval = (level.max.ceil - level.min.floor) / scaleLength;
				array(scaleLength).forEach((ind) => {
					paint(element.scale.children[scaleLength - 1 - ind], [], ['h-3'], (level.min.floor + ind * interval).toFixed(0));
				});
			}
			let memo = null;
			const distance = width / level.points.length;
			level.points.forEach((point, ind) => {
				const index = indexLevel(point.v);
				const last = ind === 0 ? point : level.points[ind - 1];
				let type = level.paths[index].length === 0 ? 'M' : 'L';
				if (last.x - point.x > distance * 8) {
					type = 'M';
				} else if (memo !== null && memo !== index) {
					const mid = { x: (last.x + point.x) / 2, y: (last.y + point.y) / 2 };
					level.paths[memo].push(`L ${mid.x.toFixed(2)} ${mid.y.toFixed(2)}`);
					level.paths[index].push(`M ${mid.x.toFixed(2)} ${mid.y.toFixed(2)}`);
					type = 'L';
				}
				memo = index;
				level.paths[index].push(`${type} ${point.x.toFixed(2)} ${point.y.toFixed(2)}`);
			});
			element.graph.setAttribute('viewBox', `0 0 ${width} 100`);
			const factor = width / (levelSkeleton.length - 1);
			const skeleton = levelSkeleton.map((value, ind) => `${ind === 0 ? 'M' : 'L'} ${(ind * factor).toFixed(2)} ${value}`);
			element.graph.children[0].setAttribute('d', skeleton.join(' '));
			if (capturedAt.start !== null && capturedAt.end !== null) {
				level.paths.forEach((path, ind) => {
					if (path.length !== 0) {
						element.graph.children[ind].setAttribute('d', path.join(' '));
					} else {
						element.graph.children[ind].removeAttribute('d');
					}
				});
			}
		};
		const errorLevel = (element, width) => {
			array(element.label.children.length).forEach((ind) => {
				error(element.label.children[ind], ['w-8', 'h-3'], [], '');
			});
			error(element.range, ['w-28', 'h-4'], []);
			array(element.range.children.length).forEach((ind) => {
				error(element.range.children[ind], [], [], '');
			});
			array(element.scale.children.length).forEach((ind) => {
				error(element.scale.children[ind], ['h-3'], [], '');
			});
			element.graph.setAttribute('viewBox', `0 0 ${width} 100`);
			array(element.graph.children.length).forEach((ind) => {
				if (ind === 0) {
					element.graph.children[ind].classList.add('stroke-red-200', 'dark:stroke-red-800');
					element.graph.children[ind].classList.remove('stroke-neutral-200', 'dark:stroke-neutral-800');
					const factor = width / (levelSkeleton.length - 1);
					const skeleton = levelSkeleton.map((value, ind) => `${ind === 0 ? 'M' : 'L'} ${(ind * factor).toFixed(2)} ${value}`);
					element.graph.children[ind].setAttribute('d', skeleton.join(' '));
				} else {
					element.graph.children[ind].removeAttribute('d');
				}
			});
		};
		const calculateBuffers = (data, width) => {
			const buffers = {
				delay: {
					min: { abs: null, floor: null },
					max: { abs: null, ceil: null },
					points: [],
					paths: array(delay.graph.children.length).map(() => []),
				},
				level: {
					min: { abs: null, floor: null },
					max: { abs: null, ceil: null },
					points: [],
					paths: array(level.graph.children.length).map(() => []),
				},
				capturedAt: { start: null, end: null },
			};
			if (data !== null) {
				buffers.capturedAt.start = Math.floor(Date.now() / 1000);
				buffers.capturedAt.end = Math.floor(Date.now() / 1000 - getRange());
				envelope(buffers, data, 'delay');
				envelope(buffers, data, 'level');
				coordinate(buffers, data, 'delay', 'capturedAt', width);
				coordinate(buffers, data, 'level', 'capturedAt', width);
			}
			return buffers;
		};
		const parseBuffers = async (response) => {
			const buffer = await response.arrayBuffer();
			const binary = new Binary(buffer);
			const buffers = [];
			while (binary.offset < buffer.byteLength) {
				const buffer = { delay: null, level: null, capturedAt: null };
				buffer.delay = binary.uint(32);
				buffer.level = binary.uint(16);
				buffer.capturedAt = binary.uint(64);
				buffers.push(buffer);
			}
			return buffers;
		};
		const loadBuffers = fetching(
			buffers,
			(context) => {
				context.width = breakpoint(delay.graph.clientWidth);
				window.requestAnimationFrame(() => loadingDelay(delay, context.width));
				window.requestAnimationFrame(() => loadingLevel(level, context.width));
			},
			(context) => {
				context.reload = getRange() / 360;
				const from = Math.floor(Date.now() / 1000) - getRange();
				const to = Math.floor(Date.now() / 1000);
				const endpoint = `/api/device/${window.location.pathname.substring(8)}?from=${from}&to=${to}`;
				return fetcher('get', endpoint, null, { controller: context.controller });
			},
			async (context, response) => (context.data = await parseBuffers(response)),
			(context) => {
				const summary = calculateBuffers(context.data, context.width);
				window.requestAnimationFrame(() => paintDelay(delay, context.width, summary.delay, summary.capturedAt));
				window.requestAnimationFrame(() => paintLevel(level, context.width, summary.level, summary.capturedAt));
				highlightRange(getRange());
			},
			(context) => {
				window.requestAnimationFrame(() => errorDelay(delay, context.width));
				window.requestAnimationFrame(() => errorLevel(level, context.width));
			}
		);
	</script>
</html>
